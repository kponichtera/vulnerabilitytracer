package service

import (
	"context"
	"fmt"
	"github.com/sirupsen/logrus"
	"vulnerabilitytracer/api/generated/api"
	"vulnerabilitytracer/db/generated/queries"
	"vulnerabilitytracer/internal/runtime"
)

func AddMockVulnerability(ctx context.Context, runtimeCtx runtime.Context,
	vulnerabilityExternalId string, severity api.VulnerabilitySeverity) error {

	err := runtimeCtx.DBQueries.CreateMockVulnerability(ctx, queries.CreateMockVulnerabilityParams{
		ExternalID: vulnerabilityExternalId,
		Severity:   string(severity),
	})
	if err != nil {
		return fmt.Errorf("error when creating mock vulnerability: %w", err)
	}

	logrus.
		WithField("externalID", vulnerabilityExternalId).
		Info("mock vulnerability created")

	return nil
}
