package fasten

import (
	"errors"
	"regexp"
)

var ErrMalformedFastenURI = errors.New("malformed FASTEN URI")

func JavaPackageFromFastenURI(fastenURI string) (string, error) {
	// Try short FASTEN URI
	regex := compileShortFastenURIRegex()
	if regex.MatchString(fastenURI) {
		matches := regex.FindStringSubmatch(fastenURI)

		return matches[regex.SubexpIndex("package")], nil
	}

	// Try full FASTEN URI
	regex = compileFullFastenURIRegex()
	if regex.MatchString(fastenURI) {
		matches := regex.FindStringSubmatch(fastenURI)

		return matches[regex.SubexpIndex("package")], nil
	}

	return "", ErrMalformedFastenURI
}

func compileShortFastenURIRegex() *regexp.Regexp {
	return regexp.MustCompile(`^/(?P<package>(.+))/(.+)$`)
}

func compileFullFastenURIRegex() *regexp.Regexp {
	return regexp.MustCompile(`^fasten://(.+)/(?P<package>(.+))/(.+)$`)
}
