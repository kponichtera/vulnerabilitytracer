package server

import (
	"context"

	"vulnerabilitytracer/api/generated/managerapi"
	"vulnerabilitytracer/pkg/manager/runtime"
	"vulnerabilitytracer/pkg/manager/service"
)

type serverInterfaceImpl struct {
	runtime.Context
}

func (s serverInterfaceImpl) GetDashboardVulnerabilities(ctx context.Context, request managerapi.GetDashboardVulnerabilitiesRequestObject) (managerapi.GetDashboardVulnerabilitiesResponseObject, error) {
	result, err := service.GetDashboardVulnerabilities(ctx, s.Context, request.Body.FromDateTime, request.Body.ToDateTime)
	if err != nil {
		return managerapi.GetDashboardVulnerabilities500JSONResponse{Message: err.Error()}, nil
	}
	return managerapi.GetDashboardVulnerabilities200JSONResponse{Vulnerabilities: result}, nil
}

func (s serverInterfaceImpl) GetLiveness(ctx context.Context, request managerapi.GetLivenessRequestObject) (managerapi.GetLivenessResponseObject, error) {
	return managerapi.GetLiveness200Response{}, nil
}

func (s serverInterfaceImpl) GetReadiness(ctx context.Context, request managerapi.GetReadinessRequestObject) (managerapi.GetReadinessResponseObject, error) {
	err := s.DBPool.Ping(ctx)
	if err != nil {
		return nil, err
	}

	return managerapi.GetReadiness200Response{}, nil
}
