package main

import (
	"flag"

	"vulnerabilitytracer-service/pkg/config"
	"vulnerabilitytracer-service/pkg/server"

	"github.com/sirupsen/logrus"
)

//nolint:gochecknoglobals
var (
	port        = flag.Int("port", 10420, "HTTP server port")
	prefork     = flag.Bool("prefork", false, "Spawn multiple listener processes")
	configFile  = flag.String("config-file", "config.yaml", "Path to YAML configuration file")
	displayHelp = flag.Bool("help", false, "Display configuration")
)

func main() {
	flag.Parse()

	var appConfig server.Config
	if *displayHelp {
		config.PrintHelpAndExit(appConfig)
	}

	config.Read(*configFile, &appConfig)

	if err := server.Run(port, prefork, &appConfig); err != nil {
		logrus.WithError(err).Fatal("server runtime error")
	}
}
