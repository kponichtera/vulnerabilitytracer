package processor

import (
	"context"

	"github.com/sirupsen/logrus"
)

type jobConfigContextKey struct{}

// ReadJobConfig fetches the job config from the context and panics if it wasn't set
func ReadJobConfig[T any](ctx context.Context, jobConfig *T) {
	config, ok := ctx.Value(jobConfigContextKey{}).(T)
	if !ok {
		logrus.Fatal("no job config in context")
	}

	*jobConfig = config
}

// writeJobConfig puts the job config in the context
func writeJobConfig[T any](ctx context.Context, jobConfig T) context.Context {
	return context.WithValue(ctx, jobConfigContextKey{}, jobConfig)
}
