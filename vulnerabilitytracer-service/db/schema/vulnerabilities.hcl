schema "vulnerabilities" {}

# FIXME: Bug in Atlas, enums are not created in the first migration and require running apply two times.
#enum "severity" {
#  schema = schema.vulnerabilities
#  values = [
#    'LOW', 'MODERATE', 'MEDIUM', 'HIGH', 'CRITICAL',
#  ]
#}

table "vulnerabilities" {
  schema = schema.vulnerabilities

  column "id" {
    type = bigserial
  }

  column "external_id" {
    type = varchar(255)
  }

  column "severity" {
    type = varchar(255)
    null = true
  }

  column "creation_time" {
    type    = timestamptz
    default = sql("now()")
  }

  primary_key {
    columns = [column.id]
  }

  index "external_id" {
    columns = [
      column.external_id,
    ]
    unique = true
  }

  check "severity" {
    expr = "severity in ('LOW', 'MODERATE', 'MEDIUM', 'HIGH', 'CRITICAL')"
  }

}
