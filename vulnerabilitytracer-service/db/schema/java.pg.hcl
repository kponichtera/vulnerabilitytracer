schema "java" {}

table "dependencies" {
  schema = schema.java

  column "id" {
    type = bigserial
  }

  column "group_id" {
    type = varchar
  }

  column "artifact_id" {
    type = varchar
  }

  column "version" {
    type = varchar(255)
  }

  column "creation_time" {
    type    = timestamptz
    default = sql("now()")
  }

  column "vulnerability_update_time" {
    type    = timestamptz
    default = sql("now()")
  }

  primary_key {
    columns = [column.id]
  }

  index "depenedency_maven_coordinates" {
    columns = [
      column.group_id,
      column.artifact_id,
      column.version
    ]
    unique = true
  }

}

table "callables" {
  schema = schema.java

  column "id" {
    type = bigserial
  }

  column "fasten_id" {
    type = varchar
  }

  column "package_name" {
    type = varchar(255)
  }

  column "class_name" {
    type = varchar(255)
  }

  column "method_name" {
    type = varchar(255)
  }

  column "creation_time" {
    type    = timestamptz
    default = sql("now()")
  }

  primary_key {
    columns = [column.id]
  }

  index "fasten_id" {
    columns = [
      column.fasten_id,
    ]
    unique = true
  }

}

table "callables_vulnerabilities" {
  schema = schema.java

  column "callable_id" {
    type = bigint
  }

  column "vulnerability_id" {
    type = bigint
  }

  primary_key {
    columns = [
      column.callable_id,
      column.vulnerability_id
    ]
  }

  foreign_key "callables_fk" {
    columns     = [column.callable_id]
    ref_columns = [table.callables.column.id]
  }

  foreign_key "vulnerability_fk" {
    columns     = [column.vulnerability_id]
    ref_columns = [table.vulnerabilities.column.id]
  }

}
