-- Add new schema named "java"
CREATE SCHEMA "java";
-- Add new schema named "service"
CREATE SCHEMA "service";
-- Add new schema named "vulnerabilities"
CREATE SCHEMA "vulnerabilities";
-- Create "callables" table
CREATE TABLE "java"."callables" ("id" bigserial NOT NULL, "fasten_id" character varying NOT NULL, "package_name" character varying(255) NOT NULL, "class_name" character varying(255) NOT NULL, "method_name" character varying(255) NOT NULL, "creation_time" timestamptz NOT NULL DEFAULT now(), PRIMARY KEY ("id"));
-- Create index "fasten_id" to table: "callables"
CREATE UNIQUE INDEX "fasten_id" ON "java"."callables" ("fasten_id");
-- Create "vulnerabilities" table
CREATE TABLE "vulnerabilities"."vulnerabilities" ("id" bigserial NOT NULL, "external_id" character varying(255) NOT NULL, "severity" character varying(255) NOT NULL, "creation_time" timestamptz NOT NULL DEFAULT now(), PRIMARY KEY ("id"), CONSTRAINT "severity" CHECK ((severity)::text = ANY (ARRAY[('UNDEFINED'::character varying)::text, ('LOW'::character varying)::text, ('MODERATE'::character varying)::text, ('MEDIUM'::character varying)::text, ('HIGH'::character varying)::text, ('CRITICAL'::character varying)::text])));
-- Create index "external_id" to table: "vulnerabilities"
CREATE UNIQUE INDEX "external_id" ON "vulnerabilities"."vulnerabilities" ("external_id");
-- Create "callables_vulnerabilities" table
CREATE TABLE "java"."callables_vulnerabilities" ("callable_id" bigint NOT NULL, "vulnerability_id" bigint NOT NULL, PRIMARY KEY ("callable_id", "vulnerability_id"), CONSTRAINT "callables_fk" FOREIGN KEY ("callable_id") REFERENCES "java"."callables" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "vulnerability_fk" FOREIGN KEY ("vulnerability_id") REFERENCES "vulnerabilities"."vulnerabilities" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "dependencies" table
CREATE TABLE "java"."dependencies" ("id" bigserial NOT NULL, "group_id" character varying NOT NULL, "artifact_id" character varying NOT NULL, "version" character varying(255) NOT NULL, "creation_time" timestamptz NOT NULL DEFAULT now(), "fasten_processed" boolean NOT NULL, "vulnerability_update_time" timestamptz NULL, PRIMARY KEY ("id"));
-- Create index "depenedency_maven_coordinates" to table: "dependencies"
CREATE UNIQUE INDEX "depenedency_maven_coordinates" ON "java"."dependencies" ("group_id", "artifact_id", "version");
-- Create "dependencies_vulnerabilities" table
CREATE TABLE "java"."dependencies_vulnerabilities" ("dependency_id" bigint NOT NULL, "vulnerability_id" bigint NOT NULL, PRIMARY KEY ("dependency_id", "vulnerability_id"), CONSTRAINT "dependencies_fk" FOREIGN KEY ("dependency_id") REFERENCES "java"."dependencies" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "vulnerability_fk" FOREIGN KEY ("vulnerability_id") REFERENCES "vulnerabilities"."vulnerabilities" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
-- Create "services" table
CREATE TABLE "service"."services" ("id" bigserial NOT NULL, "name" character varying(255) NOT NULL, "dependencies_hash" character varying(255) NOT NULL, "registration_time" timestamptz NOT NULL DEFAULT now(), PRIMARY KEY ("id"));
-- Create index "name" to table: "services"
CREATE UNIQUE INDEX "name" ON "service"."services" ("name", "dependencies_hash");
-- Create "mitigation_strategies" table
CREATE TABLE "service"."mitigation_strategies" ("service_id" bigint NOT NULL, "callable_id" bigint NOT NULL, "strategy" character varying(255) NOT NULL, PRIMARY KEY ("service_id", "callable_id"), CONSTRAINT "callables_fg" FOREIGN KEY ("callable_id") REFERENCES "java"."callables" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "services_fk" FOREIGN KEY ("service_id") REFERENCES "service"."services" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "strategy" CHECK ((strategy)::text = ANY (ARRAY[('ERROR'::character varying)::text, ('NOOP'::character varying)::text])));
-- Create "service_dependencies" table
CREATE TABLE "service"."service_dependencies" ("service_id" bigint NOT NULL, "dependency_id" bigint NOT NULL, PRIMARY KEY ("service_id", "dependency_id"), CONSTRAINT "dependencies_fk" FOREIGN KEY ("dependency_id") REFERENCES "java"."dependencies" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT "services_fk" FOREIGN KEY ("service_id") REFERENCES "service"."services" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
