-- name: GetServicesForObserving :many
SELECT id, name
FROM service.latest_services;

-- name: InsertTrace :exec
WITH service AS (
    SELECT id
    FROM service.latest_services
    WHERE name = @service_name
)
INSERT INTO trace.traces (tempo_id, service_id, time)
SELECT @tempo_id, service.id, @time
FROM service
ON CONFLICT (tempo_id) DO NOTHING;

-- name: GetTracesToScrape :many
SELECT id, tempo_id, time
FROM trace.traces
WHERE scraped IS FALSE
  AND time > @fromTime
ORDER BY time
LIMIT @batch_size;
