-- name: GetDashboardVulnerabilities :many
SELECT v.external_id, v.severity, COUNT(e.id) AS trigger_count
FROM vulnerabilities.vulnerabilities v
LEFT JOIN trace.events e ON v.external_id = e.vulnerability_external_id
AND e.time > @from_time AND e.time < @to_time
GROUP BY v.external_id, v.severity
ORDER BY v.severity DESC, trigger_count DESC;
