-- name: GetDependenciesToUpdate :many
SELECT id, group_id, artifact_id, version
FROM java.dependencies
WHERE fasten_processed IS TRUE
  AND (vulnerability_update_time IS NULL OR vulnerability_update_time < $1)
ORDER BY vulnerability_update_time
LIMIT $2;

-- name: UpdateVulnerabilityUpdateTime :exec
UPDATE java.dependencies
SET vulnerability_update_time = NOW()
WHERE id = ANY($1::bigint[]);
