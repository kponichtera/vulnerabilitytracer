package main

import (
	"flag"

	"vulnerabilitytracer/pkg/config"
	"vulnerabilitytracer/pkg/temposcraper"
	"vulnerabilitytracer/pkg/temposcraper/serviceobserver"

	"github.com/sirupsen/logrus"
)

//nolint:gochecknoglobals
var (
	configFile  = flag.String("config-file", "config.yaml", "Path to YAML configuration file")
	displayHelp = flag.Bool("help", false, "Display configuration")
)

func main() {
	flag.Parse()

	var appConfig temposcraper.Config
	if *displayHelp {
		config.PrintHelpAndExit(appConfig)
	}

	config.Read(*configFile, &appConfig)

	logrus.SetLevel(appConfig.Log.Level)

	if err := serviceobserver.Run(appConfig); err != nil {
		logrus.WithError(err).Fatal("error when running service observer")
	}
}
