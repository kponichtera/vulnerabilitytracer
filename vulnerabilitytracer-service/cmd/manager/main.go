package main

import (
	"flag"
	"github.com/sirupsen/logrus"
	"vulnerabilitytracer/pkg/config"
	"vulnerabilitytracer/pkg/manager/server"
)

const DefaultPort = 11420

//nolint:gochecknoglobals
var (
	port        = flag.Int("port", DefaultPort, "HTTP server port")
	prefork     = flag.Bool("prefork", false, "Spawn multiple listener processes")
	configFile  = flag.String("config-file", "config.yaml", "Path to YAML configuration file")
	displayHelp = flag.Bool("help", false, "Display configuration")
)

func main() {
	flag.Parse()

	var appConfig server.Config
	if *displayHelp {
		config.PrintHelpAndExit(appConfig)
	}

	config.Read(*configFile, &appConfig)

	logrus.SetLevel(appConfig.Log.Level)

	if err := server.Run(port, prefork, &appConfig); err != nil {
		logrus.WithError(err).Fatal("server runtime error")
	}
}
