package main

import (
	"flag"
	"github.com/sirupsen/logrus"
	"vulnerabilitytracer/internal/config"
	"vulnerabilitytracer/internal/fastenprocessor"
	"vulnerabilitytracer/internal/fastenprocessor/server"
)

const DefaultPort = 10421

//nolint:gochecknoglobals
var (
	port        = flag.Int("port", DefaultPort, "HTTP server port (when running as a server)")
	configFile  = flag.String("config-file", "config.yaml", "Path to YAML configuration file")
	displayHelp = flag.Bool("help", false, "Display configuration")
	oneshot     = flag.Bool("oneshot", true, "Run once and exit")
)

func main() {
	flag.Parse()

	var appConfig fastenprocessor.Config
	if *displayHelp {
		config.PrintHelpAndExit(appConfig)
	}

	config.Read(*configFile, &appConfig)

	logrus.SetLevel(appConfig.Log.Level)

	if err := server.Run(port, &appConfig); err != nil {
		logrus.WithError(err).Fatal("server runtime error")
	}

	//if *oneshot {
	//
	//} else {
	//
	//}
}
