package nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.tasks;

import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.service.CacheService;
import org.gradle.api.DefaultTask;
import org.gradle.api.GradleException;
import org.gradle.api.logging.Logger;
import org.gradle.api.tasks.TaskAction;

import java.io.IOException;

public class PruneCache extends DefaultTask {

    private Logger logger;

    public PruneCache() {
        setGroup("vulnerability tracer");
        setDescription("Removes cached vulnerabilities");
        this.logger = getProject().getLogger();
    }

    @TaskAction
    public void runTask() {
        var cacheService = new CacheService(getProject().getGradle().getGradleUserHomeDir(), logger);
        try {
            cacheService.pruneCache();
            logger.lifecycle("Cache prune complete");
        } catch (IOException e) {
            throw new GradleException("Exception has occurred when pruning the cache", e);
        }
    }

}
