package nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin;

import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.tasks.AnalyzeTask;
import org.gradle.api.Plugin;
import org.gradle.api.Project;
import org.owasp.dependencycheck.gradle.DependencyCheckPlugin;

public class VulnerabilityTracerPlugin implements Plugin<Project> {

    public static final String ANALYZE_TASK = "vulnerabilityTracerAnalyze";

    @Override
    public void apply(Project target) {
        initialize(target);
        registerTasks(target);
    }

    private void initialize(Project project) {
        project.getPlugins().apply(DependencyCheckPlugin.class);
    }

    private void registerTasks(Project project) {
        project.getTasks().register(ANALYZE_TASK, AnalyzeTask.class).configure(task -> {
            task.dependsOn(project.getTasks().findByName(DependencyCheckPlugin.ANALYZE_TASK));
        });
    }

}
