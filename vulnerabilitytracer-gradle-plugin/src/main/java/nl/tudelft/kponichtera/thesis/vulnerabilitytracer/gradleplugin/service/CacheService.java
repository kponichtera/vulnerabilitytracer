package nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.service;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.Comparator;

public class CacheService {

    public static final String CACHE_DIRECTORY = "vulnerabilityTracerCache";

    private final Path cacheDirPath;

    public CacheService(String cacheRootDir) {
        this.cacheDirPath = Path.of(cacheRootDir, CACHE_DIRECTORY);
    }

    public void ensureCacheDir() throws IOException {
        Files.createDirectories(cacheDirPath);
    }

    public void pruneCache() throws IOException {
        var files = Files.walk(cacheDirPath)
                .sorted(Comparator.reverseOrder())
                .map(Path::toFile);

        files.forEach(File::delete);
        files.close();
    }

}
