package nl.tudelft.kponichtera.thesis.vulnerabilitytracer.utils;

import lombok.experimental.UtilityClass;
import lombok.extern.java.Log;
import net.bytebuddy.agent.builder.AgentBuilder;
import net.bytebuddy.implementation.ExceptionMethod;
import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.dto.VulnerableCallable;
import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.exception.ErrorMitigationException;

import static net.bytebuddy.matcher.ElementMatchers.named;

@Log
@UtilityClass
public class TransformerUtils {

    public AgentBuilder.Transformer buildErrorTransformer(VulnerableCallable callable) {
        return (builder, typeDescription, classLoader, module, protectionDomain) -> builder
                .method(named(callable.getMethodName()))
                .intercept(ExceptionMethod.throwing(ErrorMitigationException.class));

    }

    public AgentBuilder.Transformer buildNoopTransformer(VulnerableCallable callable) {
        throw new RuntimeException("TODO: Implement");
    }

}
