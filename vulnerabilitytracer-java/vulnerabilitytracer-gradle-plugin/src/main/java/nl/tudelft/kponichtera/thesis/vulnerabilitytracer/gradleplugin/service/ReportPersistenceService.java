package nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.service;

import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.report.DependencyReport;
import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.utils.ReportMapperUtils;
import org.gradle.api.logging.Logger;

import java.io.File;
import java.io.IOException;

public class ReportPersistenceService {

    public static final String REPORT_FILENAME = "vulnerabilitytracer-dependencies.json";

    private Logger logger;

    public ReportPersistenceService(Logger logger) {
        this.logger = logger;
    }

    public void saveReport(DependencyReport report, String outputDirectoryPath) throws IOException {
        var outputDirectory = new File(outputDirectoryPath);
        var reportFile = new File(outputDirectory, REPORT_FILENAME);

        ReportMapperUtils.getMapper().writeValue(reportFile, report);
        logger.quiet("Saved report to {}", reportFile.getAbsolutePath());
    }

}
