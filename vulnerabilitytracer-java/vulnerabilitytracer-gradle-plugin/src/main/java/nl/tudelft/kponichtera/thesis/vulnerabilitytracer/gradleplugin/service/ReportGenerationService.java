package nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.service;

import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.report.DependencyReport;
import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.gradleplugin.report.MavenCoordinates;
import org.gradle.api.artifacts.ModuleVersionIdentifier;
import org.gradle.api.logging.Logger;

import java.time.ZonedDateTime;
import java.util.Collection;
import java.util.stream.Collectors;

public class ReportGenerationService {

    private Logger logger;

    public ReportGenerationService(Logger logger) {
        this.logger = logger;
    }

    public DependencyReport buildReport(Collection<ModuleVersionIdentifier> dependencies) {
        var mavenCoordinates = dependencies.stream()
                .map(ReportGenerationService::toMavenCoordinates)
                .collect(Collectors.toList());

        var report = new DependencyReport();
        report.setGenerationTime(ZonedDateTime.now());
        report.setDependencies(mavenCoordinates);
        return report;
    }

    private static MavenCoordinates toMavenCoordinates(ModuleVersionIdentifier identifier) {
        var mavenCoordinates = new MavenCoordinates();
        mavenCoordinates.setGroupId(identifier.getGroup());
        mavenCoordinates.setArtifactId(identifier.getName());
        mavenCoordinates.setVersion(identifier.getVersion());
        return mavenCoordinates;
    }

}
