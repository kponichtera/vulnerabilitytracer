FROM node:20.11 AS builder

WORKDIR /builder
COPY package.json package-lock.json ./

RUN --mount=type=cache,target=/root/.npm/_cacache npm install

COPY . .
RUN --mount=type=cache,target=/builder/.angular/cache \
    npm run build

FROM nginx:1.21-alpine AS final

COPY --from=builder /builder/dist/vulnerabilitytracer-dashboard/browser /srv/
COPY docker/nginx.conf /etc/nginx/conf.d/default.conf
