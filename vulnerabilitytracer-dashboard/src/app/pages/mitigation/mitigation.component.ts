import {Component} from '@angular/core';
import {ToolbarModule} from "primeng/toolbar";
import {ButtonModule} from "primeng/button";
import {ActivatedRoute, RouterLink} from "@angular/router";
import {Mitigation} from "../../common/mitigation";
import {TabViewModule} from "primeng/tabview";
import {MitigationTableComponent} from "./mitigation-table/mitigation-table.component";
import {MitigationTableRow} from "./mitigation-table/mitigation-table-row";
import {MitigationTableChangeEvent} from "./mitigation-table/mitigation-table-change-event";

@Component({
  selector: 'app-mitigation',
  standalone: true,
  imports: [
    ToolbarModule,
    ButtonModule,
    RouterLink,
    TabViewModule,
    MitigationTableComponent
  ],
  templateUrl: './mitigation.component.html',
  styleUrl: './mitigation.component.scss'
})
export class MitigationComponent {

  vulnerabilityId: string;

  activeIndex: number = 0;

  serviceTabs: ServiceTab[] = [
    new ServiceTab('Service 1', [
      new MitigationTableRow(0, 'org.library:badlibrary:1.2.3', 'org.library.BadLibrary.badMethod()', 0, 0, Mitigation.NONE),
      new MitigationTableRow(1, 'org.library:badlibrary:1.2.3', 'org.library.BadLibrary.badMethod()', 3, 1, Mitigation.NOOP),
      new MitigationTableRow(2, 'org.library:badlibrary:1.2.3', 'org.library.BadLibrary.badMethod()', 10, 2, Mitigation.ERROR),
    ]),
    new ServiceTab('Service 2', []),
    new ServiceTab('Service 3', [])
  ]

  constructor(private route: ActivatedRoute) {
    this.vulnerabilityId = this.route.snapshot.paramMap.get('id') || 'Unknown';
  }

  onMitigationChange(event: MitigationTableChangeEvent) {
    console.log('Mitigation change event: ' + event.mitigation);
  }

}

class ServiceTab {
  serviceName: string;
  mitigations: MitigationTableRow[];

  constructor(serviceName: string, mitigations: MitigationTableRow[]) {
    this.serviceName = serviceName;
    this.mitigations = mitigations;
  }
}
