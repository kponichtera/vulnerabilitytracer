import {AfterViewInit, Component, ElementRef, OnInit, ViewChild} from '@angular/core';
import {DataSet} from 'vis-data';
import {Network} from 'vis-network';

const SERVICE_COLOR = '#2563eb';
const VULNERABLE_SERVICE_COLOR = '#ef4444';
const API_GATEWAY_COLOR = '#0ea5e9';

@Component({
  selector: 'app-impact-graph',
  standalone: true,
  imports: [],
  templateUrl: './impact-graph.component.html',
  styleUrl: './impact-graph.component.scss'
})
export class ImpactGraphComponent implements AfterViewInit {

  @ViewChild('graph') graph: ElementRef;

  constructor() {}

  ngAfterViewInit() {
    this.buildGraph();
  }

  private buildGraph() {

    let nodes = new DataSet([
      {id: 1, label: 'API Gateway', shape: 'triangle', color: API_GATEWAY_COLOR, font: {vadjust: 50}},
      {id: 2, label: 'Service A', color: SERVICE_COLOR, font: {vadjust: 50}},
      {id: 3, label: 'Service B', color: VULNERABLE_SERVICE_COLOR, font: {vadjust: 50}},
      {id: 4, label: 'Service C', color: SERVICE_COLOR, font: {vadjust: 50}},
    ]);

    let edges = new DataSet([
      {id: 1, from: 1, to: 2, label: '10', font: {align: 'top'}, arrows: 'to'},
      {id: 2, from: 2, to: 3, label: '15', font: {align: 'top'}, arrows: 'to'},
      {id: 3, from: 3, to: 4, label: '20', font: {align: 'top'}, arrows: 'to'},
      {id: 4, from: 4, to: 2, label: '25', font: {align: 'top'}, arrows: 'to'},
    ]);

    let data = {
      nodes: nodes,
      edges: edges
    };
    let options = {
      nodes: {
        shape: 'circle',
      },
      layout: {
        randomSeed: undefined,
        improvedLayout:true
      },
      physics: {
        enabled: true,
        barnesHut: {
          gravitationalConstant: -20000,
          centralGravity: 0.3,
          springLength: 95,
          springConstant: 0.04,
          damping: 0.09,
          avoidOverlap: 0.1
        },
        solver: 'barnesHut'
      }
    };

    new Network(this.graph.nativeElement, data, options);
  }

}
