version: 3

vars:
  KUBE_NAMESPACE: "{{.KUBE_NAMESPACE}}"

includes:
  fasten-api:
    taskfile: Taskfile-telepresence-intercept.yml
    vars:
      KUBE_SERVICE: "fasten-api"
      KUBE_SERVICE_PORT: "9080"
  vulnerabilitytracer-coordinator:
    taskfile: Taskfile-telepresence-intercept.yml
    vars:
      KUBE_SERVICE: "vulnerabilitytracer-coordinator"
      KUBE_SERVICE_PORT: "10420"

tasks:
  default: "telepresence {{.CLI_ARGS}}"
  connect:
    desc: "Start Telepresence daemon and connect to the {{ .KUBE_NAMESPACE }} namespace in the cluster"
    cmd: "telepresence connect --namespace {{ .KUBE_NAMESPACE }}"
  disconnect:
    desc: "Disconnect Telepresence daemon"
    cmd: "telepresence quit"
  stop:
    desc: "Stop Telepresence daemons"
    cmd: "telepresence quit --stop-daemons"