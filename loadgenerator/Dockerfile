FROM rust:1.77-bookworm AS builder

WORKDIR /project
COPY Cargo.toml ./
COPY ./src ./src

RUN --mount=type=cache,target=/usr/local/cargo/registry cargo build --release

FROM debian:bookworm-slim AS final

RUN apt-get update \
    && apt-get install -y libssl-dev \
    && rm -rf /var/lib/apt/lists

COPY --from=builder /project/target/$TARGET/release/loadgenerator /loadgenerator
CMD ["/loadgenerator"]
