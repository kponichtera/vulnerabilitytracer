use config::{Config, ConfigError};
use serde::{Deserialize};

const CONFIG_ENV_PREFIX: &str = "LOADGENERATOR";

#[derive(Clone, Debug, Deserialize)]
pub struct LoadBalancerConfig {
    pub service_addr_one: String,
    pub service_addr_two: String,
    pub interval_ms: u64,
}

pub fn read_config() -> Result<LoadBalancerConfig, ConfigError> {
    let builder = Config::builder()
        .add_source(config::Environment::with_prefix(CONFIG_ENV_PREFIX))
        .build()
        .unwrap();

    builder.try_deserialize()
}