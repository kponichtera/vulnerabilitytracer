version: 3

vars:
  NAME: 'thesis-registry-docker-io'
  PROXY_URL: 'https://registry-1.docker.io'

tasks:
  create:
    cmds:
      - >
        k3d registry create {{.NAME}}
        --proxy-remote-url {{.PROXY_URL}}
        --volume {{.NAME}}:/var/lib/registry
    status: [ "k3d registry list {{.NAME}}" ]
  delete:
    cmds: [ "k3d registry delete {{.NAME}}" ]
    status: [ "! k3d registry list {{.NAME}}" ]
  clean:
    cmds: [ "docker volume rm -f {{.NAME}}" ]
