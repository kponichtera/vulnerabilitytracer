version: 3

vars:
  REGISTRY_LOCAL_NAME: 'thesis-registry-local'

tasks:
  create:
    cmds:
      - >
        k3d registry create {{.REGISTRY_LOCAL_NAME}}
        --port 5000
        --volume {{.REGISTRY_LOCAL_NAME}}:/var/lib/registry
    status: [ "k3d registry list {{.REGISTRY_LOCAL_NAME}}" ]
  start: "docker start k3d-{{.REGISTRY_LOCAL_NAME}}"
  stop: "docker stop k3d-{{.REGISTRY_LOCAL_NAME}}"
  delete:
    cmds: [ "k3d registry delete {{.REGISTRY_LOCAL_NAME}}" ]
    status: [ "! k3d registry list {{.REGISTRY_LOCAL_NAME}}" ]
  clean:
    cmds: [ "docker volume rm -f {{.REGISTRY_LOCAL_NAME}}" ]
