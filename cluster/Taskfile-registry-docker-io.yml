version: 3

vars:
  REGISTRY_DOCKER_IO_NAME: 'thesis-registry-docker-io'
  REGISTRY_DOCKER_IO_PROXY_URL: 'https://registry-1.docker.io'

tasks:
  create:
    cmds:
      - >
        k3d registry create {{.REGISTRY_DOCKER_IO_NAME}}
        --proxy-remote-url {{.REGISTRY_DOCKER_IO_PROXY_URL}}
        --volume {{.REGISTRY_DOCKER_IO_NAME}}:/var/lib/registry
    status: [ "k3d registry list {{.REGISTRY_DOCKER_IO_NAME}}" ]
  delete:
    cmds: [ "k3d registry delete {{.REGISTRY_DOCKER_IO_NAME}}" ]
    status: [ "! k3d registry list {{.REGISTRY_DOCKER_IO_NAME}}" ]
  clean:
    cmds: [ "docker volume rm -f {{.REGISTRY_DOCKER_IO_NAME}}" ]
