version: 3

vars:
  REGISTRY_GHCR_IO_NAME: 'thesis-registry-ghcr-io'
  REGISTRY_GHCR_IO_PROXY_URL: 'https://ghcr.io'

tasks:
  create:
    cmds:
      - >
        k3d registry create {{.REGISTRY_GHCR_IO_NAME}}
        --proxy-remote-url {{.REGISTRY_GHCR_IO_PROXY_URL}}
        --volume {{.REGISTRY_GHCR_IO_NAME}}:/var/lib/registry
    status: [ "k3d registry list {{.REGISTRY_GHCR_IO_NAME}}" ]
  start: "docker start k3d-{{.REGISTRY_GHCR_IO_NAME}}"
  stop: "docker stop k3d-{{.REGISTRY_GHCR_IO_NAME}}"
  delete:
    cmds: [ "k3d registry delete {{.REGISTRY_GHCR_IO_NAME}}" ]
    status: [ "! k3d registry list {{.REGISTRY_GHCR_IO_NAME}}" ]
  clean:
    cmds: [ "docker volume rm -f {{.REGISTRY_GHCR_IO_NAME}}" ]
