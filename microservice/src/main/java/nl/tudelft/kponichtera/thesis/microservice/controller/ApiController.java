package nl.tudelft.kponichtera.thesis.microservice.controller;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import nl.tudelft.kponichtera.thesis.microservice.properties.GeneratorProperties;
import nl.tudelft.kponichtera.thesis.microservice.service.DownstreamCallService;
import nl.tudelft.kponichtera.thesis.microservice.service.RandomGeneratorService;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@Slf4j
@RestController
@RequiredArgsConstructor
public class ApiController {

    private final DownstreamCallService downstreamCallService;
    private final RandomGeneratorService randomGeneratorService;
    private final GeneratorProperties generatorProperties;

    @GetMapping("/one")
    public void one() {
        log.info("Making 1 downstream call");
        downstreamCallService.callFirstService();
    }

    @GetMapping("/two")
    public void two() {
        log.info("Making 2 downstream calls");
        downstreamCallService.callFirstService();
        downstreamCallService.callSecondService();
    }

    @GetMapping("/terminus")
    public void terminus() {
        if (!generatorProperties.isEnabled()) {
            log.info("Terminus endpoint executed, but the generator is disabled");
            return;
        }
        log.info("Terminus endpoint executed. Generating...");

        var randomNumber = randomGeneratorService.generateRandomNumber();
        var randomUUID = randomGeneratorService.generateRandomUUID();

        log.info("Number returned from the generator: {}. UUID returned from the generator: {}", randomNumber, randomUUID);
    }
}
