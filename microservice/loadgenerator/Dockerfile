FROM python:3.11-slim AS base

FROM base AS builder

COPY requirements.txt .

RUN --mount=type=cache,target=/root/.cache/pip \
    pip install --prefix="/install" -r requirements.txt

FROM base AS final
STOPSIGNAL SIGINT

COPY --from=builder /install /usr/local

WORKDIR /app
COPY locustfile.py .

ENTRYPOINT locust --headless -u "${USERS:-2}" --host="http://${SERVICE_ADDR}"
CMD Benign