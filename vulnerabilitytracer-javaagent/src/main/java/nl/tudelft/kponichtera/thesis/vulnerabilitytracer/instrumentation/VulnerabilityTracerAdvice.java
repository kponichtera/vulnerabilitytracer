package nl.tudelft.kponichtera.thesis.vulnerabilitytracer.instrumentation;

import io.opentelemetry.api.common.AttributeKey;
import io.opentelemetry.api.trace.Span;
import io.opentelemetry.context.Context;
import io.opentelemetry.context.Scope;
import io.opentelemetry.sdk.internal.AttributesMap;
import net.bytebuddy.asm.Advice;
import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.helper.VulnerabilityHolderHelper;
import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.utils.ReportUtils;
import nl.tudelft.kponichtera.thesis.vulnerabilitytracer.utils.AdviceUtils;

import java.io.IOException;

/**
 * Rules to follow when writing advices:
 * https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/contributing/writing-instrumentation-module.md#use-advice-classes-to-write-code-that-will-get-injected-to-the-instrumented-library-classes
 */
@SuppressWarnings("unused")
public final class VulnerabilityTracerAdvice {

    @Advice.OnMethodEnter
    public static void onEnter(@Advice.Origin("#m") String methodName,
                               @Advice.Origin("#t") String typeName,
                               @Advice.Local("otelContext") Context context,
                               @Advice.Local("otelScope") Scope scope
    ) throws IOException {
        AdviceUtils.onEnter(methodName, typeName, context, scope);
    }

}
